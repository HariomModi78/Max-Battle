<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/stylesheets/register.css">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#007bff">
</head>
<body>
    <div class="loader"></div>
    <main>
        
        <div class="wellcome signupGreet">
            <p>Create new,</p>
            <p>Account</p>
        </div>
        <form action="/registerOtp" method="post">
            <input class="input" type="text" name="username" id="username" placeholder="Username" required>
                <input class="input" type="text" name="gameName" id="gameName" placeholder="Game Name" required>
                
                <input class="input" type="email" name="email" id="email" placeholder="Email" required>
                <input class="input" type="password" name="password" id="password" placeholder="Create Password" required>
                <div class="inputBox">
                    <input class="input borderNone heightFull" type="text" name="referralCode" id="referralCode" placeholder="Referal code (optional)">
                <div class="apply">Apply</div>
                </div>
                
            
            <div class="inputBox borderNone" >
                <input name="age" type="checkbox" required> <a href="/termsAndCondition">Terms and Conditions</a> 
            </div>
            
            <input  type="submit" value="Signup" class="payAndJoin"> 
            
        </form>

        <div class="fakeButton">
            <div class="lastOption"><p>Already a user? </p> <a href="/login"> login</a></div>
        </div>
        
    </main>
    <script>
        let referralCode = document.querySelector("#referralCode");
        let apply = document.querySelector(".apply");
        
        apply.addEventListener("click",async function(){
            apply.innerText = "";
            apply.innerText = "Applying...";
            apply.style.cssText = "background-color:orange"
            
            let response = await fetch("/referralCodes")
            let code  = await response.json();
            //.log(code);
            if(code.includes(referralCode.value.trim())){
                setTimeout(function(){
                apply.innerText = "Verified";
                apply.style.cssText = "background-color:green";
                referralCode.addEventListener("input",function(){
            apply.innerText = "Apply";
                apply.style.cssText = "background-color:orange"
        })
            },2000)
            }else{
                setTimeout(function(){
                apply.innerText = "Try again";
                apply.style.cssText = "background-color:orange"
            },2000)
            }
            
        })
        let loader = document.querySelector(".loader");
        let form = document.querySelector("form");
form.addEventListener("submit", function() {
    document.querySelector("main").style.display = "none";
    loader.style.display = "block";
});

window.addEventListener("pageshow", function(event) {
    if (event.persisted) {
        document.querySelector("main").style.display = "flex";
        loader.style.display = "none";
    }
});
        


     </script>
    <script src="/javaScripts/boiler.js"></script>
    <script type="module" src="/script.js"></script>

</body>
</html>
