<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/stylesheets/transaction.css">
     
    <link rel="stylesheet" href="/stylesheets/boiler.css">
    <link rel="stylesheet" href="/stylesheets/header.css">
    <link rel="stylesheet" href="/stylesheets/footer.css">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#007bff">
</head>
<body>
    <main>
        <div class="disconnect">
            <img src="/images/disconnect.webp" alt="">
        </div>
        <%if(status){%>
                <div class="withdrawCompleted">
            <%}else{%>
                <div class="withdrawCompleted" style="display: none;">
            <%}%>
               <p>Withdraw Completed</p>
               <img src="https://img.icons8.com/?size=48&id=Mw4ZtZQHm38P&format=gif" alt=""> 
               <p class="smallText">amount is sent within 48hr</p>
               <h4>Thankyou</h4>
               <div class="confirm1">Ok</div>
            </div>
        <div class="header">
            <div class="logo back" id="wallet">
                <img loading="lazy" style="height: 2rem;width: 2rem;" id="home" src="https://cdn-icons-png.flaticon.com/128/3114/3114883.png" alt="">
            </div>
            
            <div class="greet">
                <p class="big">Transaction</p>
            </div>
            <div class="notification">
                <!-- <img loading="lazy" src="https://cdn-icons-png.flaticon.com/128/2311/2311524.png" alt=""> -->
            </div>
        </div>
        <div class="fakeHeader"></div>
        <%if(transaction.length==0){%>
            <strong style="height: 60vh;width: 100vw;display: flex;justify-content: center;align-items: center;">No Data Found</strong>
        <%}%>
        <%transaction.forEach(function(val){%>
            <div class="option">
            <div class="optionPart1">
                <%let date = new Date(val.createdAt).toLocaleDateString("en-IN", { timeZone: "Asia/Kolkata" }) %>
                        <%let time = new Date(val.createdAt).toLocaleTimeString("en-IN", { timeZone: "Asia/Kolkata" }) %>
                <div class="date"><%=date%> <div class="time"><%=time%></div></div>
                <%if(!isNaN(val.paymentId)){%>

                        <%if(val.flag){%>
                            <div class="status">Completed</div>
                        <%}else{%>
                            <div class="status red"><%=val.status%>
                                <img src="https://img.icons8.com/?size=40&id=TmIKpxTOSBi7&format=gif" alt="">
                            </div>
                        <%}%>
                        
                    <%}else{%>
                        <div class="status"><%=val.status%></div>
                    <%}%>
                
            </div>
            <div class="optionPart2">
                <div class="first">
                    <div class="type">Add To Wallet</div>
                    <%if(!val.paymentId){%>
                        <div class="paymentId">#UPI id : <%=val.upiId%></div>
                    <%}else{%>
                        <div class="paymentId">#id : <%=val.paymentId%></div>
                    <%}%>
                    
                </div>
                <div class="second">
                    <%if(!val.paymentId){%>
                        -<img loading="lazy" class="verySmallCoin" src="https://cdn-icons-png.flaticon.com/128/9382/9382295.png" alt="">
                    <%=val.amount%>
                    <%}else{%>
                        <img loading="lazy" class="verySmallCoin" src="https://cdn-icons-png.flaticon.com/128/9382/9382295.png" alt="">
                    <%=val.amount%>
                    <%}%>
                    
                    
                </div>
                
            </div>
        </div>
        <%})%>
        <div class="fakeFooter"></div>
    </main>
    <!-- Popup Elements -->
<div id="popupOverlay"></div>
<div id="transactionPopup">
    <h3>Transaction Details</h3>
    <div id="popupContent"></div>
    <div id="closePopup">Close</div>
</div>

<script>
    const overlay = document.getElementById("popupOverlay");
    const popup = document.getElementById("transactionPopup");
    const popupContent = document.getElementById("popupContent");
    const closeBtn = document.getElementById("closePopup");

    document.querySelectorAll(".option").forEach(option => {
        option.addEventListener("click", () => {
            const type = option.querySelector(".type")?.innerText || "N/A";
            const paymentId = option.querySelector(".paymentId")?.innerText || "N/A";
            const date = option.querySelector(".date")?.childNodes[0]?.nodeValue?.trim() || "N/A";
            const time = option.querySelector(".time")?.innerText || "N/A";
            const statusText = option.querySelector(".status")?.innerText.trim().toLowerCase() || "";

            let statusFormatted = "Pending";
            if (statusText.includes("completed")) {
                statusFormatted = "Completed";
            }

            const amount = option.querySelector(".second")?.innerText.trim() || "N/A";

            popupContent.innerHTML = `
                <strong>Type:</strong> ${type}<br>
                <strong>Payment Id: ${paymentId.split(":")[1]}</strong><br>
                <strong>Status:</strong> ${statusFormatted}<br>
                <strong>Date:</strong> ${date}<br>
                <strong>Time:</strong> ${time}<br>
                <strong>Amount:</strong> ${amount}
            `;

            popup.style.display = "flex";
            overlay.style.display = "block";
        });
    });

    closeBtn.addEventListener("click", () => {
        popup.style.display = "none";
        overlay.style.display = "none";
    });

    window.addEventListener("click", (e) => {
        if (e.target === overlay) {
            popup.style.display = "none";
            overlay.style.display = "none";
        }
    });
</script>

    <script>
         window.addEventListener("click",function(){
            document.querySelector(".withdrawCompleted").style.display = "none";
        })
    </script>
    <script src="/javaScripts/back.js"></script>
    <script src="/javaScripts/boiler.js"></script>
    <script type="module" src="/script.js"></script>

</body>
</html>